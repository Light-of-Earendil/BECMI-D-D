// ==========================================================================
// Modal System & App Structure
// ==========================================================================

// Loading Screen
.loading-screen
  position: fixed
  top: 0
  left: 0
  width: 100%
  height: 100%
  background: linear-gradient(180deg, var(--wood-700), var(--wood-900))
  display: flex
  align-items: center
  justify-content: center
  z-index: 9999

.loading-spinner
  text-align: center
  color: var(--text-strong)

  i
    font-size: 3rem
    margin-bottom: var(--space-4)
    color: var(--brass-300)
    animation: spin 2s linear infinite

  p
    font-family: "Cinzel", Georgia, serif
    font-size: 1.25rem
    font-weight: 500

@keyframes spin
  from
    transform: rotate(0deg)
  to
    transform: rotate(360deg)

// App Container
.app-container
  min-height: 100vh
  display: none
  flex-direction: column

  &.loaded
    display: flex

// Header
.app-header
  background: linear-gradient(180deg, var(--wood-600), var(--wood-800))
  color: var(--text-strong)
  box-shadow: var(--shadow-wood)
  position: sticky
  top: 0
  z-index: 100
  border-bottom: 2px solid var(--wood-900)
  max-height: 60px

.dashboard-header
  margin: 50px 0

.characters-header
  margin: 50px 0

.header-content
  max-width: 1280px
  margin: 0 auto
  padding: 0
  display: flex
  align-items: center
  justify-content: space-between
  gap: var(--space-6)
  max-height: 60px

.logo
  display: flex
  align-items: center
  gap: var(--space-3)
  height: 50px
  padding-top: 10px

  i
    font-size: 2rem
    color: var(--brass-300)
    margin-top: -17px

  h1,
  .brand
    font-family: "Cinzel", Georgia, serif
    font-size: 1.5rem
    font-weight: 700
    letter-spacing: 0.02em
    color: var(--text-strong)
    text-shadow: 0 2px 4px rgba(0,0,0,0.5)

.main-nav ul
  display: flex
  list-style: none
  gap: var(--space-2)
  margin: 0
  padding: 0

.nav-link
  color: var(--text-soft)
  text-decoration: none
  padding: var(--space-2) var(--space-4)
  border-radius: var(--radius-md)
  transition: all var(--t-fast) var(--ease)
  font-weight: 500
  position: relative

  &:hover
    background-color: rgba(202, 162, 74, 0.15)
    color: var(--text-strong)
    transform: translateY(-1px)

  &.active
    background: linear-gradient(180deg, var(--parchment-300), var(--parchment-500))
    color: var(--wood-900)
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.5)

.user-menu
  position: relative
  cursor: pointer

.user-info
  display: flex
  align-items: center
  gap: var(--space-2)
  padding: var(--space-2) var(--space-3)
  border-radius: var(--radius-md)
  transition: background-color var(--t-fast) var(--ease)

  &:hover
    background-color: rgba(202, 162, 74, 0.15)

  i
    font-size: 1.5rem
    color: var(--brass-300)

.user-dropdown
  position: absolute
  top: 100%
  right: 0
  margin-top: var(--space-2)
  background: linear-gradient(180deg, var(--parchment-200), var(--parchment-400))
  color: var(--text-ink)
  border-radius: var(--radius-md)
  box-shadow: 0 10px 30px rgba(0,0,0,0.5)
  padding: var(--space-2)
  min-width: 150px
  display: none
  border: 1px solid rgba(0,0,0,0.3)

  a
    display: block
    padding: var(--space-2) var(--space-3)
    color: var(--text-ink)
    text-decoration: none
    border-radius: var(--radius-sm)
    transition: background-color var(--t-fast) var(--ease)

    &:hover
      background-color: var(--parchment-100)

// Main Content
.main-content
  flex: 1
  padding: var(--space-6)

.content-area
  max-width: 1280px
  margin: 0 auto

  &:has(.hex-map-editor),
  &:has(.hex-map-play)
    max-width: 100%
    margin: 0
    padding: 0
    height: calc(100vh - 158px)
    overflow: hidden

.view
  display: none

  &.active
    display: block

.view-header
  margin-bottom: var(--space-6)

  h2
    font-family: "Cinzel", Georgia, serif
    font-size: 2rem
    font-weight: 700
    color: var(--text-strong)
    margin-bottom: var(--space-2)
    text-shadow: 0 2px 4px rgba(0,0,0,0.5)

  p
    color: var(--text-soft)
    font-size: 1.125rem

// Footer
.app-footer
  background: linear-gradient(180deg, var(--wood-600), var(--wood-800))
  color: var(--text-soft)
  text-align: center
  padding: var(--space-4)
  margin-top: auto
  border-top: 2px solid var(--wood-900)
  box-shadow: inset 0 2px 0 var(--bevel-light), 0 -4px 10px rgba(0,0,0,0.3)

// Modal System
.modal
  position: fixed
  top: 0
  left: 0
  width: 100%
  height: 100%
  background-color: rgba(0, 0, 0, 0.6)
  display: none
  align-items: center
  justify-content: center
  z-index: var(--z-modal)
  padding: var(--space-4)
  box-sizing: border-box

  &.show
    display: flex

.modal-backdrop
  position: fixed
  inset: 0
  background: rgba(0,0,0,0.6)
  display: none
  place-items: center
  z-index: var(--z-modal)
  padding: var(--space-4)

  &[open]
    display: grid

.modal-content
  background: linear-gradient(180deg, var(--wood-600), var(--wood-800))
  border-radius: var(--radius-lg)
  box-shadow: 0 10px 30px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.2)
  border: 1px solid rgba(0,0,0,0.6)
  max-width: 500px
  width: 90%
  max-height: 90vh
  overflow-y: auto
  position: relative

  &.character-creation
    max-width: 800px

  &.character-edit
    max-width: 700px
    left: 50%
    transform: translateX(-50%)

  &.session-creation
    max-width: 600px

.modal-header
  padding: var(--space-6) var(--space-6) var(--space-4)
  border-bottom: 2px solid var(--wood-900)

  h2
    font-family: "Cinzel", Georgia, serif
    color: var(--text-strong)
    font-size: 1.75rem
    margin-bottom: var(--space-2)
    text-shadow: 0 2px 4px rgba(0,0,0,0.5)

  p
    color: var(--text-soft)

.modal__inner
  margin: var(--space-4) var(--space-6)
  background: linear-gradient(180deg, var(--parchment-200), var(--parchment-400))
  border-radius: var(--radius-lg)
  padding: var(--space-6)
  color: var(--text-ink)
  box-shadow: inset 0 2px 0 rgba(255,255,255,0.25), inset 0 -3px 0 rgba(0,0,0,0.25), 0 8px 32px rgba(0,0,0,0.3)
  border: 2px solid var(--wood-700)
  max-width: 90vw
  max-height: 90vh
  overflow-y: auto

.modal-overlay
  position: fixed
  top: 0
  left: 0
  width: 100%
  height: 100%
  background: rgba(0, 0, 0, 0.6)
  display: flex
  align-items: center
  justify-content: center
  z-index: calc(var(--z-modal) + 1)
  padding: var(--space-4)

// Auth Forms
.auth-form
  padding: var(--space-6)

  .form-group
    margin-bottom: var(--space-4)

  label
    color: var(--wood-800)
    margin-bottom: var(--space-2)

  input
    background: linear-gradient(180deg, var(--parchment-100), var(--parchment-300))
    color: var(--text-ink)

// Tabs System
.tabs
  display: flex
  gap: var(--space-2)
  margin-bottom: var(--space-3)
  border-bottom: 2px solid var(--wood-800)

.tab
  padding: var(--space-2) var(--space-4)
  border-radius: var(--radius-md) var(--radius-md) 0 0
  background: linear-gradient(180deg, var(--wood-500), var(--wood-700))
  color: var(--text-soft)
  border: 1px solid rgba(0,0,0,0.5)
  border-bottom: none
  cursor: pointer
  transition: all var(--t-fast) var(--ease)
  user-select: none

  &:hover
    background: linear-gradient(180deg, var(--wood-400), var(--wood-600))
    color: var(--text-strong)

  &[aria-selected="true"]
    background: linear-gradient(180deg, var(--parchment-300), var(--parchment-500))
    color: var(--wood-900)
    border-bottom: 2px solid var(--parchment-500)
    margin-bottom: -2px

// Table Component
.table
  width: 100%
  border-collapse: collapse
  background: linear-gradient(180deg, var(--parchment-100), var(--parchment-300))
  color: var(--text-ink)
  border-radius: var(--radius-sm)
  overflow: hidden

  th,
  td
    padding: var(--space-3)
    border-bottom: 1px solid rgba(0,0,0,0.15)
    text-align: left

  thead th
    background: linear-gradient(180deg, var(--wood-400), var(--wood-600))
    color: var(--text-soft)
    font-weight: 600
    position: sticky
    top: 0
    text-shadow: 0 1px 2px rgba(0,0,0,0.3)

  tbody tr
    &:hover
      background: var(--parchment-200)

    &:last-child td
      border-bottom: none

// Toast Notifications
.notifications-container,
.toast
  position: fixed
  bottom: var(--space-4)
  right: var(--space-4)
  z-index: var(--z-toast)
  display: flex
  flex-direction: column
  gap: var(--space-2)
  pointer-events: none

.toast,
.notification
  background: linear-gradient(180deg, var(--wood-600), var(--wood-800))
  color: var(--text-soft)
  padding: var(--space-3) var(--space-4)
  border-radius: var(--radius-md)
  border: 1px solid rgba(0,0,0,0.5)
  box-shadow: 0 8px 24px rgba(0,0,0,0.45)
  pointer-events: auto
  display: flex
  align-items: center
  gap: var(--space-3)
  min-width: 250px
  max-width: 400px

  &--success
    border-left: 4px solid var(--green-crt)

  &--error
    border-left: 4px solid var(--red-500)

  &--warning
    border-left: 4px solid var(--brass-300)

  &--info
    border-left: 4px solid var(--teal-400)

// Tooltip
.tooltip
  position: relative
  cursor: help

  &:hover::after
    content: attr(data-tip)
    position: absolute
    bottom: 100%
    left: 50%
    transform: translateX(-50%)
    background: linear-gradient(180deg, var(--wood-600), var(--wood-800))
    color: var(--text-soft)
    padding: var(--space-2) var(--space-3)
    border-radius: var(--radius-sm)
    white-space: nowrap
    border: 1px solid rgba(0,0,0,0.5)
    box-shadow: 0 3px 12px rgba(0,0,0,0.45)
    z-index: var(--z-dropdown)
    margin-bottom: var(--space-2)

// Card System
.card
  background: linear-gradient(180deg, var(--wood-600), var(--wood-800))
  border-radius: var(--radius-lg)
  box-shadow: var(--shadow-wood)
  padding: var(--space-5)
  margin-bottom: var(--space-4)
  position: relative

  &::before
    content: ""
    position: absolute
    inset: 6px
    border-radius: calc(var(--radius-lg) - 6px)
    box-shadow: inset 0 2px 0 var(--bevel-light), inset 0 -2px 0 rgba(0,0,0,0.55)
    pointer-events: none

.card-header
  border-bottom: 2px solid var(--wood-900)
  padding-bottom: var(--space-3)
  margin-bottom: var(--space-4)

.card-title
  font-family: "Cinzel", Georgia, serif
  color: var(--text-strong)
  font-size: 1.5rem
  font-weight: 600
  text-shadow: 0 2px 4px rgba(0,0,0,0.5)

.card-subtitle
  color: var(--text-soft)
  font-size: 0.875rem
  margin-top: var(--space-2)
