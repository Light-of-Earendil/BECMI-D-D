// ==========================================================================
// Modal System & App Structure
// ==========================================================================

// Loading Screen
.loading-screen
  position: fixed
  top: 0
  left: 0
  width: 100%
  height: 100%
  background: linear-gradient(180deg, var(--wood-700), var(--wood-900))
  display: flex
  align-items: center
  justify-content: center
  z-index: 9999

.loading-spinner
  text-align: center
  color: var(--text-strong)

  i
    font-size: 3rem
    margin-bottom: var(--space-4)
    color: var(--brass-300)
    animation: spin 2s linear infinite

  p
    font-family: "Cinzel", Georgia, serif
    font-size: 1.25rem
    font-weight: 500

@keyframes spin
  from
    transform: rotate(0deg)
  to
    transform: rotate(360deg)

// App Container
.app-container
  min-height: 100vh
  display: none
  flex-direction: column

  &.loaded
    display: flex

// Header
.app-header
  gradient-wood()
  color: var(--text-strong)
  shadow-wood()
  position: sticky
  top: 0
  z-index: 100
  border-bottom: 2px solid var(--wood-900)
  max-height: 60px

.dashboard-header
  margin: 50px 0

.characters-header
  margin: 50px 0

.header-content
  container-base(1280px, 0)
  flex-between()
  gap: var(--space-6)
  max-height: 60px

.logo
  flex-row(center, flex-start)
  gap: var(--space-3)
  height: 50px
  padding-top: 10px

  i
    font-size: 2rem
    color: var(--brass-300)
    margin-top: -17px

  h1,
  .brand
    heading-base()
    font-size: 1.5rem
    font-weight: 700
    letter-spacing: 0.02em
    color: var(--text-strong)
    text-shadow-strong()

.main-nav ul
  nav-base()

.nav-link
  nav-link-base()

  &.active
    nav-link-active()

.nav-dropdown
  dropdown-base()

  > .nav-link
    nav-link-base()

    i
      margin-left: var(--space-1)
      font-size: 0.75rem
      transition: transform var(--t-fast) var(--ease)

  &:hover > .nav-link i
    transform: rotate(180deg)

  .dropdown-menu
    dropdown-menu()
    left: 0
    right: auto

    li
      list-style: none

      a
        dropdown-item()

.user-menu
  position: relative
  cursor: pointer

.user-info
  flex-row(center, flex-start)
  gap: var(--space-2)
  padding: var(--space-2) var(--space-3)
  border-radius: var(--radius-md)
  transition-color()

  &:hover
    background-color: rgba(202, 162, 74, 0.15)

  i
    font-size: 1.5rem
    color: var(--brass-300)

.user-dropdown
  dropdown-menu()

  a
    dropdown-item()

    i
      width: 16px
      text-align: center
      color: var(--brass-500)

    &:hover
      background-color: var(--parchment-100)

// Main Content
.main-content
  flex: 1
  padding: var(--space-6)

.content-area
  max-width: 1280px
  margin: 0 auto

  &:has(.hex-map-editor),
  &:has(.hex-map-play)
    max-width: 100%
    margin: 0
    padding: 0
    height: calc(100vh - 158px)
    overflow: hidden

.view
  display: none

  &.active
    display: block

.view-header
  margin-bottom: var(--space-6)

  h2
    heading-base()
    font-size: 2rem
    font-weight: 700
    color: var(--text-strong)
    margin-bottom: var(--space-2)
    text-shadow-strong()

  p
    color: var(--text-soft)
    font-size: 1.125rem

// Footer
.app-footer
  gradient-wood()
  color: var(--text-soft)
  text-align: center
  padding: var(--space-4)
  margin-top: auto
  border-top: 2px solid var(--wood-900)
  bevel-inset()
  shadow-drop(4px, 10px, 0.3)

// Modal System
.modal
  modal-base()

  &.show
    display: flex

.modal-backdrop
  position: fixed
  inset: 0
  background: rgba(0,0,0,0.6)
  display: none
  place-items: center
  z-index: var(--z-modal)
  padding: var(--space-4)

  &[open]
    display: grid

.modal-content
  modal-content()

  &.character-creation
    max-width: 800px

  &.character-edit
    max-width: 700px
    left: 50%
    transform: translateX(-50%)

  &.session-creation
    max-width: 600px

  &.character-creation
    max-width: 800px

  &.character-edit
    max-width: 700px
    left: 50%
    transform: translateX(-50%)

  &.session-creation
    max-width: 600px

.modal-header
  padding: var(--space-6) var(--space-6) var(--space-4)
  border-bottom: 2px solid var(--wood-900)
  display: flex
  justify-content: space-between
  align-items: flex-start
  position: relative

  h2
    font-family: "Cinzel", Georgia, serif
    color: var(--text-strong)
    font-size: 1.75rem
    margin-bottom: var(--space-2)
    text-shadow: 0 2px 4px rgba(0,0,0,0.5)
    flex: 1

  p
    color: var(--text-soft)

.modal-close
  position: absolute
  top: var(--space-4)
  right: var(--space-4)
  background: transparent
  border: none
  color: var(--text-strong)
  font-size: 1.5rem
  cursor: pointer
  padding: var(--space-1)
  width: 32px
  height: 32px
  display: flex
  align-items: center
  justify-content: center
  border-radius: var(--radius-sm)
  transition: all var(--t-fast) var(--ease)

  &:hover
    background: rgba(255, 255, 255, 0.1)
    color: var(--text-strong)

  i
    font-size: 1.25rem

.modal-body
  padding: var(--space-6)
  background: linear-gradient(180deg, var(--parchment-200), var(--parchment-400))
  color: var(--wood-900)
  max-height: 60vh
  overflow-y: auto

.modal-footer
  padding: var(--space-4) var(--space-6) var(--space-6)
  border-top: 2px solid var(--wood-900)
  display: flex
  justify-content: flex-end
  gap: var(--space-2)

// ==========================================================================
// Item Details Modal Styling
// ==========================================================================

.item-details-container
  color: var(--wood-900)

.item-header
  display: flex
  gap: var(--space-4)
  margin-bottom: var(--space-4)
  padding-bottom: var(--space-4)
  border-bottom: 2px solid var(--brass-500)

.item-image-container-large
  position: relative
  width: 200px
  min-height: 200px
  flex-shrink: 0
  display: flex
  align-items: center
  justify-content: center
  background: linear-gradient(180deg, var(--parchment-100), var(--parchment-300))
  border-radius: var(--radius-md)
  border: 2px solid var(--wood-600)
  overflow: hidden

.item-image-large
  width: 100%
  height: 100%
  min-height: 200px
  display: flex
  align-items: center
  justify-content: center
  background: linear-gradient(180deg, var(--wood-200), var(--wood-300))

  img
    max-width: 100%
    max-height: 100%
    object-fit: contain
    padding: var(--space-2)

.item-icon-large
  width: 120px
  height: 120px
  background: linear-gradient(180deg, var(--brass-300), var(--brass-500))
  border-radius: var(--radius-md)
  display: flex
  align-items: center
  justify-content: center
  // Remove border when inside container to avoid double border
  border: none
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.3)
  position: absolute
  top: 50%
  left: 50%
  transform: translate(-50%, -50%)

  i
    color: var(--wood-900)
    font-size: 3rem

  &.magical-item
    border-color: var(--brass-700)
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.3), 0 0 20px rgba(202, 162, 74, 0.5)

.item-info
  flex: 1

  h4
    font-family: "Cinzel", Georgia, serif
    color: var(--wood-900)
    font-size: 1.5rem
    font-weight: 600
    margin-bottom: var(--space-2)

  .item-type
    font-family: "VT323", monospace
    color: var(--wood-700)
    font-size: 0.875rem
    font-weight: 600
    text-transform: capitalize

.item-description-full
  margin-top: var(--space-4)
  padding-top: var(--space-4)
  border-top: 2px solid var(--brass-500)

  h6
    font-family: "Cinzel", Georgia, serif
    color: var(--wood-900)
    font-size: 1rem
    font-weight: 600
    margin-bottom: var(--space-2)

  .item-description
    font-family: 'Lora', Georgia, 'Times New Roman', serif
    color: var(--wood-800)
    font-size: 0.9375rem
    line-height: 1.6
    margin: 0

.item-properties
  margin-top: var(--space-4)

.properties-grid
  display: grid
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr))
  gap: var(--space-3)

.property
  display: flex
  flex-direction: column
  gap: var(--space-1)
  padding: var(--space-2)
  background: linear-gradient(180deg, var(--parchment-100), var(--parchment-300))
  border: 1px solid rgba(0, 0, 0, 0.1)
  border-radius: var(--radius-sm)
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.3)

  label
    font-family: "Cinzel", Georgia, serif
    color: var(--wood-800)
    font-size: 0.75rem
    font-weight: 600
    text-transform: uppercase
    letter-spacing: 0.5px

  span
    font-family: "VT323", monospace
    color: var(--wood-900)
    font-size: 1rem
    font-weight: 700

    &.unidentified
      color: var(--red-500)
      font-weight: 700

    &.attunement-attuned
      color: var(--green-crt-dim)
      font-weight: 700

    &.attunement-cursed
      color: var(--red-500)
      font-weight: 700

.item-special-properties,
.item-magical-properties,
.item-notes,
.item-variants
  margin-top: var(--space-4)
  padding-top: var(--space-4)
  border-top: 2px solid var(--brass-500)

  h6
    font-family: "Cinzel", Georgia, serif
    color: var(--wood-900)
    font-size: 1rem
    font-weight: 600
    margin-bottom: var(--space-2)

  pre
    font-family: "VT323", monospace
    color: var(--wood-900)
    font-size: 0.875rem
    background: linear-gradient(180deg, var(--parchment-100), var(--parchment-300))
    padding: var(--space-2)
    border-radius: var(--radius-sm)
    border: 1px solid rgba(0, 0, 0, 0.1)
    overflow-x: auto

  p
    font-family: 'Lora', Georgia, 'Times New Roman', serif
    color: var(--wood-800)
    font-size: 0.9375rem
    line-height: 1.6
    margin: 0

    strong
      color: var(--wood-900)
      font-weight: 600

.modal__inner
  margin: var(--space-4) var(--space-6)
  background: linear-gradient(180deg, var(--parchment-200), var(--parchment-400))
  border-radius: var(--radius-lg)
  padding: var(--space-6)
  color: var(--text-ink)
  box-shadow: inset 0 2px 0 rgba(255,255,255,0.25), inset 0 -3px 0 rgba(0,0,0,0.25), 0 8px 32px rgba(0,0,0,0.3)
  border: 2px solid var(--wood-700)
  max-width: 90vw
  max-height: 90vh
  overflow-y: auto
  
  // Ensure file inputs are clickable
  input[type="file"]
    position: relative
    z-index: 10
    pointer-events: auto
    cursor: pointer
    opacity: 1
    width: 100%
    padding: var(--space-2)
    background: linear-gradient(180deg, var(--parchment-100), var(--parchment-200))
    border: 2px solid var(--wood-600)
    border-radius: var(--radius-sm)
    font-family: "Lora", Georgia, serif
    font-size: 1rem
    color: var(--wood-900)
    
    &:hover
      border-color: var(--brass-500)
      background: linear-gradient(180deg, var(--parchment-100), var(--parchment-300))
    
    &:focus
      outline: none
      border-color: var(--brass-500)
      box-shadow: 0 0 0 3px rgba(202, 162, 74, 0.3)

.modal-overlay
  position: fixed
  top: 0
  left: 0
  width: 100%
  height: 100%
  background: rgba(0, 0, 0, 0.6)
  display: flex
  align-items: center
  justify-content: center
  z-index: calc(var(--z-modal) + 1)
  padding: var(--space-4)

// Auth Forms
.auth-form
  padding: var(--space-6)

  .form-group
    margin-bottom: var(--space-4)

  label
    color: var(--wood-800)
    margin-bottom: var(--space-2)

  input
    background: linear-gradient(180deg, var(--parchment-100), var(--parchment-300))
    color: var(--text-ink)

  // Password input with visibility toggle
  .password-input-wrapper
    position: relative
    display: flex
    align-items: center

    input[type="password"],
    input[type="text"]
      padding-right: 45px
      width: 100%

    .password-toggle-btn
      position: absolute
      right: 8px
      top: 50%
      transform: translateY(-50%)
      background: transparent
      border: none
      cursor: pointer
      padding: var(--space-2)
      color: var(--wood-700)
      display: flex
      align-items: center
      justify-content: center
      width: 32px
      height: 32px
      border-radius: var(--radius-sm)
      transition: all var(--t-fast) var(--ease)
      z-index: 1

      &:hover
        background: rgba(0, 0, 0, 0.05)
        color: var(--wood-900)

      &:active
        transform: translateY(-50%) scale(0.95)

      &:focus-visible
        outline: 2px solid var(--brass-500)
        outline-offset: 2px

      i
        font-size: 1rem
        pointer-events: none

// Tabs System
.tabs
  display: flex
  gap: var(--space-2)
  margin-bottom: var(--space-3)
  border-bottom: 2px solid var(--wood-800)

.tab
  padding: var(--space-2) var(--space-4)
  border-radius: var(--radius-md) var(--radius-md) 0 0
  background: linear-gradient(180deg, var(--wood-500), var(--wood-700))
  color: var(--text-soft)
  border: 1px solid rgba(0,0,0,0.5)
  border-bottom: none
  cursor: pointer
  transition: all var(--t-fast) var(--ease)
  user-select: none

  &:hover
    background: linear-gradient(180deg, var(--wood-400), var(--wood-600))
    color: var(--text-strong)

  &[aria-selected="true"]
    background: linear-gradient(180deg, var(--parchment-300), var(--parchment-500))
    color: var(--wood-900)
    border-bottom: 2px solid var(--parchment-500)
    margin-bottom: -2px

// Table Component
.table
  width: 100%
  border-collapse: collapse
  background: linear-gradient(180deg, var(--parchment-100), var(--parchment-300))
  color: var(--text-ink)
  border-radius: var(--radius-sm)
  overflow: hidden

  th,
  td
    padding: var(--space-3)
    border-bottom: 1px solid rgba(0,0,0,0.15)
    text-align: left

  thead th
    background: linear-gradient(180deg, var(--wood-400), var(--wood-600))
    color: var(--text-soft)
    font-weight: 600
    position: sticky
    top: 0
    text-shadow: 0 1px 2px rgba(0,0,0,0.3)

  tbody tr
    &:hover
      background: var(--parchment-200)

    &:last-child td
      border-bottom: none

// Toast Notifications
.notifications-container,
.toast
  position: fixed
  bottom: var(--space-4)
  right: var(--space-4)
  z-index: var(--z-toast)
  display: flex
  flex-direction: column
  gap: var(--space-2)
  pointer-events: none

.toast,
.notification
  background: linear-gradient(180deg, var(--wood-600), var(--wood-800))
  color: var(--text-soft)
  padding: var(--space-3) var(--space-4)
  border-radius: var(--radius-md)
  border: 1px solid rgba(0,0,0,0.5)
  box-shadow: 0 8px 24px rgba(0,0,0,0.45)
  pointer-events: auto
  display: flex
  align-items: center
  gap: var(--space-3)
  min-width: 250px
  max-width: 400px

  &--success
    border-left: 4px solid var(--green-crt)

  &--error
    border-left: 4px solid var(--red-500)

  &--warning
    border-left: 4px solid var(--brass-300)

  &--info
    border-left: 4px solid var(--teal-400)

// Tooltip
.tooltip
  position: relative
  cursor: help

  &:hover::after
    content: attr(data-tip)
    position: absolute
    bottom: 100%
    left: 50%
    transform: translateX(-50%)
    background: linear-gradient(180deg, var(--wood-600), var(--wood-800))
    color: var(--text-soft)
    padding: var(--space-2) var(--space-3)
    border-radius: var(--radius-sm)
    white-space: nowrap
    border: 1px solid rgba(0,0,0,0.5)
    box-shadow: 0 3px 12px rgba(0,0,0,0.45)
    z-index: var(--z-dropdown)
    margin-bottom: var(--space-2)

// Card System
.card
  background: linear-gradient(180deg, var(--wood-600), var(--wood-800))
  border-radius: var(--radius-lg)
  box-shadow: var(--shadow-wood)
  padding: var(--space-5)
  margin-bottom: var(--space-4)
  position: relative

  &::before
    content: ""
    position: absolute
    inset: 6px
    border-radius: calc(var(--radius-lg) - 6px)
    box-shadow: inset 0 2px 0 var(--bevel-light), inset 0 -2px 0 rgba(0,0,0,0.55)
    pointer-events: none

.card-header
  border-bottom: 2px solid var(--wood-900)
  padding-bottom: var(--space-3)
  margin-bottom: var(--space-4)

.card-title
  font-family: "Cinzel", Georgia, serif
  color: var(--text-strong)
  font-size: 1.5rem
  font-weight: 600
  text-shadow: 0 2px 4px rgba(0,0,0,0.5)

.card-subtitle
  color: var(--text-soft)
  font-size: 0.875rem
  margin-top: var(--space-2)

